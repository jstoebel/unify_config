---
- name: copy nginx config file
  copy:
    src: "files/nginx_conf"
    dest: "/etc/nginx/nginx.conf"

  notify:
    - test nginx config file
    - restart nginx

- name: install server blocks

  template:
    src: templates/{{item}}.j2
    dest: "/etc/nginx/sites-enabled/{{item}}"
    mode: 644
    owner: root
    group: root
  with_items:
    - default
    - rails_app

  notify:
    - test nginx config file
    - restart nginx
